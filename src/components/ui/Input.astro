---
type InputType =
  | "text"
  | "email"
  | "password"
  | "tel"
  | "url"
  | "number"
  | "search";
type InputMode =
  | "none"
  | "text"
  | "decimal"
  | "numeric"
  | "tel"
  | "search"
  | "email"
  | "url";

interface Props {
  type?: InputType;
  label: string;
  name: string;
  value?: string;
  errorMessage?: string;
  required?: boolean;
  disabled?: boolean;
  readonly?: boolean;
  placeholder?: string;
  autocomplete?: string;
  minlength?: number;
  maxlength?: number;
  pattern?: string;
  inputmode?: InputMode;
}

const inputModeMap: Record<InputType, InputMode> = {
  text: "text",
  email: "email",
  password: "text",
  tel: "tel",
  url: "url",
  number: "decimal",
  search: "search",
};

const {
  type = "text",
  label,
  name,
  value,
  errorMessage,
  required = false,
  disabled = false,
  readonly = false,
  placeholder,
  autocomplete,
  minlength,
  maxlength,
  pattern,
  inputmode,
} = Astro.props;

const errorId = `${name}-error`;
const resolvedInputMode = inputmode ?? inputModeMap[type];
---

<fieldset class={errorMessage && "has-error"}>
  <label for={name}>
    <span>{label}</span>
    <input
      id={name}
      name={name}
      type={type}
      value={value}
      placeholder={placeholder}
      autocomplete={autocomplete}
      required={required}
      disabled={disabled}
      readonly={readonly}
      minlength={minlength}
      maxlength={maxlength}
      pattern={pattern}
      inputmode={resolvedInputMode}
      aria-invalid={!!errorMessage}
      aria-errormessage={errorMessage ? errorId : undefined}
    />
  </label>

  <output id={errorId} for={name} role="alert">
    {errorMessage}
  </output>
</fieldset>
